/**
 * @license
 * itsa 2.1.20
 * Copyright 2021 Josh Wright <https://www.joshwright.com> 
 * MIT LICENSE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Itsa={})}(this,(function(t){"use strict";function e(t){return t instanceof o?t:"function"==typeof t?d.constructorIs(t):d.equal(t)}o.extend(class{any(...t){const s={schemas:t.flat().map((t=>e(t)))};return this.predicates.push({id:"any",settings:s}),this}},{id:"any",validate:(t,e)=>{const{key:s,val:i,parent:r,validation:a,exists:n,result:d}=t,{schemas:o}=e;if(0!==o.length){for(const e of o){if(e._validate({key:s,parent:r,val:i,exists:n,settings:a,path:t.path}).ok)return}d.addError("No schemas matched.")}}});o.extend(class{anything(){return this.predicates.push({id:"anything",settings:null}),this}},{id:"anything",validate:t=>{}});o.extend(class{array(t){const s={example:t?e(t):null};return this.predicates.push({id:"array",settings:s}),this}},{id:"array",validate:(t,e)=>{const{val:s,validation:i,exists:r,result:a,type:n}=t,{example:d}=e;if(!Array.isArray(s))return a.addError(`Expected array but found ${n}`);if(d&&s.length)for(let e=0;e<s.length;e++){const n=s[e],o=d._validate({key:e,parent:s,val:n,exists:r,settings:i,path:[...t.path,e]});a.combine(o)}}});o.extend(class{between(t,e,s={}){const i=s;return i.min=t,i.max=e,this.predicates.push({id:"between",settings:i}),this}},{id:"between",validate:(t,e)=>{const{val:s,result:i}=t,{min:r,max:a}=e,n=e.inclusive??!0;(n?s<r:s<=r)&&i.addError(`Value cannot be under ${r}`);(n?s>a:s>=a)&&i.addError(`Value cannot be above ${a}`)}});o.extend(class{boolean(){return this.predicates.push({id:"boolean",settings:null}),this}},{id:"boolean",validate:t=>{const{type:e,result:s}=t;"boolean"!==e&&s.addError(`Expected bool but found ${e}`)}});o.extend(class{constructorIs(t){const e={cls:t};return this.predicates.push({id:"constructor",settings:e}),this}},{id:"constructor",validate:(t,e)=>{const{val:s,result:i}=t;if(!(null!=s&&s.constructor===e.cls))return i.addError(`Expected to be ${e.cls}`)}});o.extend(class{convert(t){const e={converter:t};return this.predicates.push({id:"convert",settings:e}),this}to(t){const e={converter:t};return this.predicates.push({id:"convert",settings:e}),this}},{id:"convert",validate:(t,e)=>{const{val:s,setVal:i,result:r}=t,{converter:a}=e;if("function"==typeof a)try{i(a(s))}catch(t){r.addError(t)}}});o.extend(class{date(){return this.predicates.push({id:"date",settings:null}),this}},{id:"date",validate:t=>{const{val:e,result:s}=t,i=Object.prototype.toString.call(e);if("[object Date]"!==i)return s.addError(`Expected date but found ${i}`);isFinite(e)||s.addError("Date is not valid")}});o.extend(class{default(t,e={}){return e.val=t,this.predicates.push({id:"default",settings:e}),this}defaultNow(){return this.predicates.push({id:"defaultNow",settings:null}),this}},{id:"default",validate:(t,e)=>{const{val:s,setVal:i}=t;(e.falsy??!1?!s:null==s)&&i(e.val)}},{id:"defaultNow",validate:t=>{const{val:e,setVal:s}=t;null==e&&s(new Date)}});const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;o.extend(class{email(){return this.predicates.push({id:"email",settings:null}),this}},{id:"email",validate:t=>{const{val:e,type:i,result:r}=t;if("string"!==i)return r.addError(`Expected email but found ${i}`);s.test(e)||r.addError("Email address is invalid")}});o.extend(class{equal(t,e={}){return e.example=t,this.predicates.push({id:"equal",settings:e}),this}},{id:"equal",validate:(t,e)=>{const{val:s,result:i}=t,{example:r}=e;(e.strict??!0?s===r:s==r)||i.addError(`Did not equal ${r}`)}});o.extend(class{falsy(){return this.predicates.push({id:"falsy",settings:null}),this}},{id:"falsy",validate:t=>{const{val:e,result:s}=t;if(e)return s.addError("Expected falsy value.")}});o.extend(class{function(t={}){return t.length&&(t.length=e(t.length)),this.predicates.push({id:"function",settings:t}),this}},{id:"function",validate:(t,e)=>{const{val:s,type:i,result:r}=t;if("function"!==i)return r.addError("Expected function");if(e.length){const i=e.length._validate({key:"length",parent:null,val:s.length,exists:!0,settings:t.validation,path:t.path});r.combine(i)}}});o.extend(class{instanceof(t){const e={cls:t};return this.predicates.push({id:"instanceof",settings:e}),this}},{id:"instanceof",validate:(t,e)=>{const{val:s,result:i}=t;s instanceof e.cls||i.addError(`Expected instance of ${e.cls}`)}});o.extend(class{integer(){return this.predicates.push({id:"integer",settings:null}),this}},{id:"integer",validate:t=>{const{val:e,result:s}=t;"number"==typeof e&&!1===isNaN(e)&&-1===[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY].indexOf(e)&&e%1==0||s.addError("Invalid integer")}});o.extend(class{length(t,e){let s={min:t,max:e};return"number"==typeof t&&"number"!=typeof e&&(s={exactly:t}),"number"!=typeof t&&(s={min:1}),this.predicates.push({id:"length",settings:s}),this}},{id:"length",validate:(t,e)=>{const{val:s,result:i}=t,r=s?s.length:null;return"number"!=typeof r?i.addError("Invalid length"):"number"==typeof e.exactly&&e.exactly!==r?i.addError(`Expected length to be ${e.exactly}`):"number"==typeof e.min&&e.min>r?i.addError(`Expected length to be at least ${e.min}`):"number"==typeof e.max&&e.max<r?i.addError(`Expected length to be at most ${e.max}`):void 0}});o.extend(class{matches(t){const e={regex:t};return this.predicates.push({id:"matches",settings:e}),this}},{id:"matches",validate:(t,e)=>{const{val:s,result:i}=t;e.regex.test(String(s))||i.addError(`Does not match ${e.regex}`)}});o.extend(class{max(t,e){const s={max:t,inclusive:e=e??!0};return this.predicates.push({id:"max",settings:s}),this}under(t,e){const s={max:t,inclusive:e=e??!1};return this.predicates.push({id:"max",settings:s}),this}below(t,e){const s={max:t,inclusive:e=e??!1};return this.predicates.push({id:"max",settings:s}),this}atMost(t,e){const s={max:t,inclusive:e=e??!0};return this.predicates.push({id:"max",settings:s}),this}},{id:"max",validate:(t,e)=>{const{val:s,result:i}=t,{max:r,inclusive:a}=e;if(a){s<=r||i.addError(`Value must be at most ${r}`)}else{s<r||i.addError(`Value must be less than ${r}`)}}});o.extend(class{min(t,e){const s={min:t,inclusive:e=e??!0};return this.predicates.push({id:"min",settings:s}),this}over(t,e){const s={min:t,inclusive:e=e??!1};return this.predicates.push({id:"min",settings:s}),this}above(t,e){const s={min:t,inclusive:e=e??!1};return this.predicates.push({id:"min",settings:s}),this}atLeast(t,e){const s={min:t,inclusive:e=e??!0};return this.predicates.push({id:"min",settings:s}),this}},{id:"min",validate:(t,e)=>{const{val:s,result:i}=t,{min:r,inclusive:a}=e;if(a){s>=r||i.addError(`Value must be at least ${r}`)}else{s>r||i.addError(`Value must be greater than ${r}`)}}});o.extend(class{notEmpty(){return this.predicates.push({id:"notEmpty",settings:null}),this}},{id:"notEmpty",validate:t=>{const{val:e,result:s}=t,i=e?e.length:null;if("number"!=typeof i||!i)if("[object Object]"!==Object.prototype.toString.call(e))s.addError("Value cannot be empty");else{let t=!1;for(const s in e)if(e.hasOwnProperty(s)){t=!0;break}t||s.addError("Object cannot be empty")}}});o.extend(class{null(){return this.predicates.push({id:"equal",settings:{example:null,strict:!0}}),this}undefined(){const t={example:void 0,strict:!0};return this.predicates.push({id:"equal",settings:t}),this}});o.extend(class{number(){return this.predicates.push({id:"number"}),this}},{id:"number",validate:t=>{const{val:e,type:s,result:i}=t;return"number"!==s?i.addError(`Expected number but type is ${s}.`):isNaN(e)?i.addError("Expected number but found NaN."):isFinite(e)?void 0:i.addError("Expected number but found infinity.")}});o.extend(class{object(t,s={}){let i=null;if(t){i={};for(const s in t)i[s]=e(t[s])}s.key&&(s.key=e(s.key)),s.value&&(s.value=e(s.value));const r={example:i,config:s};return this.predicates.push({id:"object",settings:r}),this}},{id:"object",validate:(t,e)=>{const{val:s,parent:i,validation:r,result:a,type:n}=t,{example:d,config:o}=e,l=o.extras??!1;if(!s)return a.addError(`Expected object but value is ${s}.`);if("object"!==n)return a.addError(`Expected object but type is ${n}.`);if(s instanceof RegExp)return a.addError("Expected object but type is regex.");if(s instanceof Date)return a.addError("Expected object but type is date.");if(Array.isArray(s))return a.addError("Expected object but type is array.");const c=Object.keys(s);if(d){const e=Object.keys(d);for(const n of e){if(!i&&r.partial&&!c.includes(n))continue;const e=d[n]._validate({key:n,parent:s,val:s[n],exists:n in s,settings:r,path:[...t.path,n]});a.combine(e)}if(!l){const t=c.filter((t=>!e.includes(t)));t.length&&a.addError(`Extra unknown properties: ${t.join(", ")}`)}}if(o.key)for(const e of c){const i=o.key._validate({key:e,parent:s,val:e,exists:!0,settings:r,path:[...t.path,e]});a.combine(i)}if(o.value)for(const e of c){const i=s[e],n=o.value._validate({key:e,parent:s,val:i,exists:!0,settings:r,path:[...t.path,e]});a.combine(n)}}});const i=/^[0-9a-f]{24}$/i;o.extend(class{objectid(){return this.predicates.push({id:"objectid",settings:null}),this}},{id:"objectid",validate:(t,e)=>{const{val:s,result:r,type:a}=t;return s?"string"!==a?r.addError("ObjectId must be a string"):24!==s.length?r.addError("ObjectId must have 24 characters"):i.test(s)?void 0:r.addError("ObjectId may only contain 0-9, a-z"):r.addError("ObjectId is required")}});const r=t=>{const e=Object.prototype.toString.call(t),s="[object Object]"===e;if(!s&&!("[object Array]"===e))return t;for(const e in t)t[e]=r(t[e]);if(s&&t.predicates){const e=new o;return e.predicates=t.predicates,e}return t};o.extend(class{load(t){return this.predicates=r(t).predicates,this}});o.extend(class{string(){return this.predicates.push({id:"string",settings:null}),this}},{id:"string",validate:t=>{const{type:e,result:s}=t;if("string"!==e)return s.addError("Expected string")}});o.extend(class{toDate(){return this.predicates.push({id:"toDate",settings:null}),this}toFloat(){return this.predicates.push({id:"toFloat",settings:null}),this}toInt(t){const e={radix:t};return this.predicates.push({id:"toInt",settings:e}),this}toLowerCase(){return this.predicates.push({id:"toLowerCase"}),this}toUpperCase(){return this.predicates.push({id:"toUpperCase"}),this}toNow(){return this.predicates.push({id:"toNow"}),this}toString(){return this.predicates.push({id:"toString"}),this}toTrimmed(){return this.predicates.push({id:"toTrimmed"}),this}},{id:"toDate",validate:t=>{const{val:e,setVal:s,result:i}=t,r=new Date(e);if(!isFinite(r.getTime()))return i.addError("Date conversion failed");s(r)}},{id:"toFloat",validate:t=>{const{val:e,setVal:s,result:i}=t,r=parseFloat(e);if(isNaN(r))return i.addError("Float conversion failed");s(r)}},{id:"toInt",validate:(t,e)=>{const{val:s,setVal:i,result:r}=t,{radix:a}=e,n=parseInt(s,a??10);if(isNaN(n))return r.addError("Int conversion failed");i(n)}},{id:"toLowerCase",validate:t=>{const{val:e,setVal:s}=t;s(String(e).toLowerCase())}},{id:"toUpperCase",validate:t=>{const{val:e,setVal:s}=t;s(String(e).toUpperCase())}},{id:"toNow",validate:t=>{const{setVal:e}=t;e(new Date)}},{id:"toString",validate:t=>{const{val:e,setVal:s}=t;s(String(e))}},{id:"toTrimmed",validate:t=>{const{val:e,setVal:s}=t;s(String(e).trim())}});o.extend(class{truthy(){return this.predicates.push({id:"truthy",settings:null}),this}},{id:"truthy",validate:t=>{const{val:e,result:s}=t;if(!e)return s.addError("Expected truthy value.")}});o.extend(class{typeof(t){const e={type:t};return this.predicates.push({id:"typeof",settings:e}),this}},{id:"typeof",validate:(t,e)=>{const{val:s,result:i}=t,{type:r}=e;r!==typeof s&&i.addError(`Expected ${r}`)}});o.extend(class{unique(t){const e={getter:t};return this.predicates.push({id:"unique",settings:e}),this}},{id:"unique",validate:(t,e)=>{const{val:s,result:i}=t,{getter:r}=e,a=new Set;for(const t in s){let e=s[t];if(r&&(e=r(e)),a.has(e))return i.addError(`${e} occurred multiple times`);a.add(e)}}});o.extend(class{_validate(t){const{key:e}=t,s=new n(t.settings.exhaustive,e,t.path);s.value=t.val;try{const e=e=>{t.parent?(t.parent[t.key]=e,t.val=e):s.value=e};for(const i of this.predicates){const r=o.validators[i.id];if(!r)throw new Error(`Validator not found: ${i.id}`);const a={setVal:e,result:s,val:t.val,key:t.key,parent:t.parent,exists:t.exists,type:typeof t.val,validation:t.settings,path:t.path};if(r.validate(a,i.settings),!s.ok)return s}}catch(t){if("STOP_ON_FIRST_ERROR"!==t)throw t}return s}validate(t,e={}){return this._validate({val:t,settings:e,key:null,parent:null,exists:!0,path:[]})}validOrThrow(t,e){const s=this.validate(t,e);if(!s.ok){const t=new a(`${s.errors[0].path.join(".")}: ${s.errors[0].message}`);throw t.result=s,t}}});o.extend(class{verify(t){const e={verifier:t};return this.predicates.push({id:"verify",settings:e}),this}},{id:"verify",validate:(t,e)=>{const{val:s,result:i}=t,{verifier:r}=e;try{const t=r(s);if("boolean"==typeof t)return void(!1===t&&i.addError("Value is invalid"));if("string"==typeof t)return i.addError(t)}catch(t){if("STOP_ON_FIRST_ERROR"===t)throw t;return i.addError(t)}}});class a extends Error{}class n{constructor(t,e,s){this.exhaustive=t,this.key=e,this.path=s,this.ok=!0,this.errors=[]}addError(t){if(this.ok=!1,this.message=t,this.errors.push({message:t,key:this.key,path:this.path}),!this.exhaustive)throw"STOP_ON_FIRST_ERROR"}combine(t){this.ok=this.ok&&t.ok;for(const e of t.errors)if(this.errors.push(e),!this.exhaustive)throw"STOP_ON_FIRST_ERROR"}}const d={predicates:[]};class o{constructor(){this.predicates=[]}static extend(t,...e){for(const t of e)o.validators[t.id]=t;const s=Object.getOwnPropertyNames(t.prototype).filter((t=>"constructor"!==t));for(const e of s){const s=t.prototype[e];o.prototype[e]=s,"function"==typeof s&&(d[e]=(...t)=>(new o)[e](...t))}}}o.validators={},t.Itsa=o,t.ItsaValidationException=a,t.ItsaValidationResult=n,t.itsa=d,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=itsa.min.js.map
